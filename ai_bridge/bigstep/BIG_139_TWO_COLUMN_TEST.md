# BIG_139: 한 페이지 전체 (2열 레이아웃) OCR+AI 파싱 테스트

> 생성일: 2026-01-03
> 목표: 2열 레이아웃 정답지 이미지에서 OCR+AI 파싱이 정상 작동하는지 확인

---

## ⚠️ 작성 전 체크리스트 (Desktop Opus 필수 확인!)

> 이 체크리스트 완료 전에 스몰스텝 작성 금지!

### 기본 확인
- [x] 로컬 코드 확인했나? → BIG_138에서 수정 완료된 코드 사용
- [x] 수정할 파일/줄 번호 특정했나? → 코드 수정 없음, 테스트만
- [x] **새 함수/로직에 safePrint 로그 추가 지시했나?** → 기존 로그 사용

### 테스트 환경
- [x] 테스트 계정 리셋 필요한가? → 아니오
- [x] 빌드 필요한가? → 예, 폰 빌드
- [x] 듀얼 빌드 필요한가? → 아니오

### 플로우 확인
- [x] **진입 경로**: 나의 책 → 교재 선택 → 정답지 촬영 → 갤러리에서 선택

---

## ⚠️ 필수: 템플릿 읽고 작업할 것!

**Opus가 작업 전 반드시 읽어야 할 파일:**
```
C:\gitproject\EDU-VICE-Attendance\ai_bridge\templates\BIGSTEP_TEMPLATE.md
```

---

## 배경

### BIG_138 성공 조건
- 입력: **한 열만 잘라낸 이미지** (309.png, 450x1237)
- 결과: ✅ 성공 (3페이지, 섹션별 정답 정상 파싱)

### PDF 테스트 실패
- 입력: PDF 전체 (2열 × 여러 페이지)
- 결과: ❌ 실패 ("61페이지" 오인식, 정답 엉망)

### 이번 테스트 목표
- 입력: **한 페이지 전체 (2열 레이아웃)**
- 기대: 2열이어도 정상 파싱되는지 확인

---

## 테스트 이미지 설명

정답지 한 페이지 구조:
```
┌─────────────────┬─────────────────┐
│  UNIT 01        │  UNIT 04        │
│  Practice p.09  │  Practice p.15  │
│  A, B, C, D     │  A, B, C, D     │
├─────────────────┼─────────────────┤
│  UNIT 02        │  Grammar &      │
│  Practice p.11  │  Writing        │
│  A, B, C, D     │  pp.16-17       │
├─────────────────┼─────────────────┤
│  UNIT 03        │  Task 1~4       │
│  Practice p.13  │                 │
│  A, B, C        │                 │
└─────────────────┴─────────────────┘
```

**포함된 페이지:** p.9, p.11, p.13, p.15, pp.16-17

---

## 환경

- 프로젝트: `C:\gitproject\EDU-VICE-Attendance\flutter_application_1`
- 코드 수정: 없음 (BIG_138 코드 그대로)
- 테스트 기기: 폰 (RFCY40MNBLL)
- **테스트 이미지**: 정답지 한 페이지 전체 (2열 레이아웃)
  - CP가 제공한 이미지를 폰 갤러리에 저장해서 사용

---

## 🎯 기대 결과 & 테스트 시나리오

### 성공 기준
```
로그에서 확인:
[Claude] p.9 섹션 A: N개 정답   ← N > 0
[Claude] p.11 섹션 A: N개 정답  ← N > 0
[Claude] p.13 섹션 A: N개 정답  ← N > 0
[Claude] p.15 섹션 A: N개 정답  ← N > 0 (있으면)
[Claude] 총 X개 페이지 파싱 완료  ← X >= 3
```

### 실패 판정 기준
- "61페이지" 같은 이상한 페이지 번호
- 섹션 정답 개수 0개
- 페이지 순서 엉망 (p.15 → p.9 → p.11 등)

### 테스트 시나리오
```
1. 테스트 이미지를 폰 갤러리에 저장
2. 앱 실행 → 나의 책 탭
3. 테스트용 교재 선택
4. 정답지 촬영 → "갤러리에서 선택"
5. 2열 레이아웃 이미지 선택
6. AI 분석 진행 확인
7. 저장 확인 다이얼로그 → 정답 내용 확인
8. 로그 분석
```

---

## 스몰스텝

### 0. 테스트 이미지 준비
- [ ] CP가 제공한 정답지 전체 페이지 이미지를 폰 갤러리에 저장
- [ ] 이미지 확인: 2열 레이아웃, UNIT 01~04 + Grammar & Writing 포함

### 1. flutter analyze (선택)
- [ ] 에러 확인 (BIG_138에서 통과했으므로 스킵 가능):
```bash
cd C:\gitproject\EDU-VICE-Attendance\flutter_application_1
flutter analyze
```

### 2. 폰 빌드 & 실행
- [ ] 빌드 명령:
```bash
flutter run -d RFCY40MNBLL
```
- [ ] 빌드 성공 확인

### 3. 테스트 실행

#### 3-1. 갤러리 선택 테스트
- [ ] 앱에서 나의 책 탭 이동
- [ ] 테스트용 교재 선택
- [ ] 정답지 촬영 버튼 탭
- [ ] **"갤러리에서 선택"** 탭
- [ ] **2열 레이아웃 이미지** 선택

#### 3-2. 로그 확인 (핵심!)

**OCR 결과:**
```
[MlKitOcr] 분석 완료: XX개 블록
[AnswerParser] OCR 텍스트 길이: XXXX  ← BIG_138보다 클 것 (2열이니까)
```

**AI 파싱 결과 - 페이지 번호 확인:**
```
[Claude] p.9 섹션 A: N개 정답   ← 정상 페이지 번호인가?
[Claude] p.11 섹션 A: N개 정답
[Claude] p.13 섹션 A: N개 정답
...
```

**이상 징후 체크:**
- [ ] "61페이지" 같은 이상한 번호 없는지?
- [ ] 섹션 정답 개수가 0인 것 없는지?
- [ ] 페이지 개수가 합리적인지? (3~5개 예상)

#### 3-3. UI 확인
- [ ] 저장 확인 다이얼로그 표시됨
- [ ] 페이지 번호가 정상인지? (p.9, p.11, p.13 등)
- [ ] 정답 내용이 실제 값인지?

---

## 예상 결과 비교

| 항목 | BIG_138 (1열) | BIG_139 (2열) 예상 |
|------|---------------|-------------------|
| OCR 블록 수 | 59개 | 100~150개 (2배+) |
| 텍스트 길이 | 800자 | 1500~2000자 |
| 페이지 수 | 3개 | 3~5개 |
| 페이지 번호 | 9, 11, 13 | 9, 11, 13, 15, 16 |

---

## 로그 저장

테스트 완료 후:
```
ai_bridge/logs/big_139_test.log
```

**저장할 내용:**
1. OCR 블록 수, 텍스트 길이
2. `[Claude]` 태그 로그 전체 (페이지별 섹션 정답 개수)
3. 최종 파싱 결과 (성공/실패)

---

## 완료 조건

### 성공 시
1. 2열 레이아웃에서도 정상 파싱됨
2. 페이지 번호 정확 (9, 11, 13, 15 등)
3. 섹션별 정답 개수 > 0
4. **결론: PDF도 "페이지별 이미지 변환" 전략으로 해결 가능**

### 실패 시
1. 페이지 번호 오인식 (61페이지 등)
2. 섹션 정답 0개 또는 엉망
3. **결론: 2열 분리 전처리 필요**

---

## 다음 단계 (테스트 결과에 따라)

### 성공하면
→ PDF 처리 전략: PDF → 페이지별 이미지 → 개별 OCR+AI → 합치기

### 실패하면
→ 2열 분리 로직 추가 필요 (BIG_133에서 만들었던 열 분리 로직 활용)

---

## ⚠️ Opus 필수 확인사항

1. **템플릿 먼저 읽기**: `ai_bridge/templates/BIGSTEP_TEMPLATE.md`
2. **로그 직접 확인**: 특히 페이지 번호가 이상한지 체크
3. **BIG_138과 비교**: 1열 vs 2열 차이 분석
4. **컨텍스트 관리**: 스몰스텝 완료 시 `/compact`
