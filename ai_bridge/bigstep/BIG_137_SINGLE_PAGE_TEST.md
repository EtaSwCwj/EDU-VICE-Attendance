# BIG_137: 단일 페이지 OCR+AI 파싱 검증 테스트

> 생성일: 2026-01-03
> 목표: 1페이지 이미지만으로 OCR+AI 파싱 정확도 검증

---

## ⚠️ Opus 필수: 템플릿 먼저 읽기!

```bash
view ai_bridge/templates/BIGSTEP_TEMPLATE.md
```

---

## 배경

### BIG_136 실패 원인
- 207페이지 인식 (실제 17페이지)
- 정답 내용 비어있음 (sections 파싱 실패)
- API 컨텍스트 초과 (183K + 21K > 200K 토큰)

### 이번 테스트 목적
- **변수 최소화**: PDF 전체 대신 1페이지 이미지만 테스트
- **검증 포인트**: OCR+AI 파싱 방식 자체가 작동하는지 확인
- **결과에 따른 판단**:
  - 성공 → 청크 분할 방식으로 개선
  - 실패 → OCR+AI 파싱 방식 포기, 다른 방향 탐색

---

## 환경

- 프로젝트: C:\gitproject\EDU-VICE-Attendance
- Flutter 경로: C:\gitproject\EDU-VICE-Attendance\flutter_application_1
- 테스트 이미지: CP가 제공할 정답지 1페이지 스크린샷
- 예상 정답 (p.9 기준):
  ```
  Unit 01 문장을 이루는 요소
  A) 1.목적어 2.동사 3.수식어 4.보어
  B) 1.wrote 2.My teacher 3.great 4.dinner
  C) 1.주어,동사,보어 2.주어,동사,목적어,수식어 ...
  D) 1.Tom and I go to the same school. ...
  ```

---

## 🎯 기대 결과 & 테스트 시나리오

### 기대 결과 (성공 시)
1. 페이지 번호: 9 (또는 11, 13 등 실제 번호)
2. 섹션: A, B, C, D 구분됨
3. 정답 내용: 실제 텍스트가 들어있음 (빈칸 아님)

### 실패 판정 기준
- 페이지 번호 틀림 (p.2, p.207 등)
- 섹션 이상함 (I, X, Y 등 단어 중간 대문자)
- 정답 내용 비어있음

### 테스트 시나리오
```
1. CP가 정답지 1페이지 이미지 제공
2. 앱에서 카메라/갤러리로 해당 이미지 선택
3. OCR+AI 파싱 진행
4. 인식 결과 다이얼로그 확인
5. 로그에서 [TextParse], [AnswerParser], [MlKitOcr] 확인
```

---

## 스몰스텝

### 0. 현재 코드 상태 확인
- [ ] BIG_136에서 추가한 코드가 적용되어 있는지 확인
- [ ] `lib/shared/services/claude_api_service.dart` - `parseOcrTextToAnswers()` 존재 확인
- [ ] `lib/shared/services/answer_parser_service.dart` - AI 파싱 로직 확인

### 1. 테스트 빌드
- [ ] `flutter run -d RFCY40MNBLL`
- [ ] 빌드 성공 확인

### 2. 단일 페이지 테스트
- [ ] CP가 제공한 1페이지 이미지로 테스트
- [ ] 정답지 등록 → 카메라/갤러리에서 이미지 선택
- [ ] 또는: 개발자가 테스트용 1페이지 이미지를 기기에 저장 후 테스트

### 3. 로그 수집 (필수!)
- [ ] Flutter 콘솔에서 아래 태그 로그 수집:
  - `[MlKitOcr]` - OCR 블록 수, 텍스트 길이
  - `[AnswerParser]` - OCR 텍스트 내용 앞부분
  - `[TextParse]` - AI API 호출/응답
- [ ] 로그 저장: `ai_bridge/logs/big_137_test.log`

### 4. 결과 분석
- [ ] 인식된 페이지 번호 확인
- [ ] 섹션 구분 확인 (A, B, C, D?)
- [ ] 정답 내용 확인 (비어있나?)
- [ ] API 에러 있나? (429, 400 등)

### 5. 보고서 작성 (필수!)
- [ ] 파일: `ai_bridge/report/big_137_report.md`
- [ ] 포함 내용:
  - 테스트 환경 (이미지 크기, 내용)
  - OCR 결과 (블록 수, 텍스트 샘플)
  - AI 파싱 결과 (페이지 번호, 섹션, 정답)
  - 성공/실패 판정 및 원인 분석
  - 다음 방향 제안

---

## 검증 규칙 (v7.3)

- 에러 메시지만 보고 실패 판정 금지
- 실제 화면/동작 확인 후 판정
- **로그 필수 확인** - 보고서만 읽지 말고 로그도 직접 확인

---

## ⚠️ 컨텍스트 관리

- 스몰스텝 2개 완료마다 `/compact` 실행
- 로그는 grep 필터링: `grep -E "\[MlKitOcr\]|\[AnswerParser\]|\[TextParse\]"`

---

## 로그 저장 형식

```markdown
# BIG_137 테스트 로그

## 환경
- 테스트 이미지: [설명]
- 이미지 크기: [가로x세로]

## OCR 결과
- 블록 수: XX개
- 텍스트 길이: XXXX자
- 텍스트 샘플 (앞 500자):
```
[OCR 텍스트]
```

## AI 파싱 결과
- API 응답 상태: 200/400/429
- 파싱된 페이지 수: X개
- 페이지 번호: [X, Y, Z]
- 섹션: [A, B, C, D] 또는 [이상한 값]
- 정답 내용: [있음/없음]

## 에러 (있으면)
```
[에러 메시지]
```
```

---

## 완료 조건

1. 단일 페이지 테스트 완료
2. 로그 저장 완료 (`ai_bridge/logs/big_137_test.log`)
3. 보고서 작성 완료 (`ai_bridge/report/big_137_report.md`)
4. 성공/실패 판정 및 원인 분석 완료
5. CP가 "테스트 종료" 입력

---

## 결과에 따른 다음 방향

### 성공 시
- 청크 분할 방식으로 전체 PDF 처리 개선
- 세로 병합 이미지 크기 제한

### 실패 시
- OCR+AI 텍스트 파싱 방식 포기
- 대안 검토:
  - 이미지 직접 AI 전송 (BIG_134 방식 재시도)
  - 교재별 하드코딩
  - 사용자 수동 입력
