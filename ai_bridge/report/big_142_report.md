# BIG_142 테스트 결과 보고서

> 생성일: 2026-01-04
> 목표: PDF 변환 이미지와 갤러리 이미지의 OCR 차이 원인 분석을 위한 상세 로그 추가

## 요약
- **결과: ✅ 성공**
- OCR 텍스트 원본과 AI 응답 전체를 로깅하는 기능 추가 완료
- PDF 이미지 해상도 정보 로깅 기능 추가 완료

## 수정 내용

### 1. answer_parser_service.dart
- OCR 텍스트 원본 로그 추가 (앞 500자 + 뒤 500자)
- 1000자 이상일 경우 앞뒤 500자씩, 이하일 경우 전체 출력

### 2. claude_api_service.dart
- AI 입력 OCR 텍스트 앞 300자 로그 추가
- AI 응답 전체 JSON 로그 추가 (기존에는 300자만)

### 3. answer_camera_page.dart
- PDF 이미지별 해상도 정보 로그 추가
- 이미지 경로, 크기(KB), 해상도(width x height) 출력

## 테스트 결과

### PDF 이미지 정보
```
[PDF처리] - 이미지 1:
[PDF처리]   경로: /data/user/0/.../pdf_page_1.png
[PDF처리]   크기: 336.1 KB
[PDF처리]   해상도: 1132 x 1614

[PDF처리] - 이미지 2:
[PDF처리]   경로: /data/user/0/.../pdf_page_2.png
[PDF처리]   크기: 855.5 KB
[PDF처리]   해상도: 2266 x 1614
```

### OCR 텍스트 분석
```
[AnswerParser] OCR 총 길이: 1824자
[AnswerParser] OCR 앞 500자:
CHAPTER
01.
UNIT 04 5
Practice
UNIT 01 RA
...

[AnswerParser] OCR 뒤 500자:
 little brother
1 X, You look so happy!
3 for
5 us his painting
Task 4
...
```

### AI 파싱 결과
```json
{
  "pages": [
    {
      "pageNumber": 16,
      "unitName": "UNIT 02",
      ...
    },
    {
      "pageNumber": 17,
      "unitName": "UNIT 03",
      ...
    }
  ]
}
```

## 발견된 문제

### 1. OCR 텍스트에 페이지 번호 미포함
- OCR 텍스트에서 직접적인 페이지 번호(p.16, p.17 등)가 발견되지 않음
- "UNIT 04 5", "Practice" 등의 텍스트만 인식됨
- AI가 컨텍스트를 보고 페이지 번호를 추론하는 것으로 보임

### 2. 해상도 차이
| 이미지 타입 | 해상도 | 특징 |
|------------|--------|------|
| PDF 첫 페이지 | 1132 x 1614 | 표지(단일 열) |
| PDF 중간 페이지 | 2266 x 1614 | 본문(2열) |

### 3. OCR 품질 이슈
- OCR 텍스트가 깨진 부분 있음 ("UNIT 01 RA" → "UNIT 01 R A"?)
- 페이지 번호가 아예 읽히지 않는 것이 핵심 문제

## 결론

### 문제 원인
1. **OCR 문제가 아님**: OCR은 텍스트를 읽고 있으나, 페이지 번호 자체가 포함되지 않음
2. **AI 추론 문제**: AI가 UNIT 번호나 컨텍스트를 보고 페이지 번호를 추론하는데, PDF와 갤러리 이미지에서 다르게 추론함
3. **이미지 품질 문제 아님**: 해상도는 충분함 (2266 x 1614)

### 다음 단계 제안

#### BIG_143: OCR 텍스트 전체 비교
- 갤러리 이미지(p.9,11,13,15 인식)와 PDF 이미지(p.16,17 인식)의 OCR 텍스트 전체를 비교
- 동일한 내용인지, 다른 페이지인지 확인

#### BIG_144: 프롬프트 개선
- AI에게 페이지 번호가 없을 때 추론하지 말고 "페이지 번호 없음"으로 처리하도록 지시
- 또는 UNIT 번호 기반으로 일관성 있게 페이지 번호를 매핑하는 로직 추가

#### BIG_145: 페이지 번호 직접 OCR
- 페이지 상단/하단의 페이지 번호 영역만 별도 OCR 처리
- 페이지 번호를 명시적으로 찾도록 개선

## 로그 파일
- 저장 위치: `ai_bridge/logs/big_142_test.log`
- 필터링 명령: `adb logcat -d | grep -E "\[AnswerParser\]|\[Claude\]|\[PDF처리\]" | tail -300`

## 성과
- ✅ OCR 텍스트 원본 확인 가능
- ✅ AI 응답 전체 확인 가능
- ✅ 이미지 해상도 정보 확인 가능
- ✅ 문제 원인 파악: 페이지 번호가 OCR에서 인식되지 않고 AI가 추론하는 것