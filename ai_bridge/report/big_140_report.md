# BIG_140 테스트 결과 보고서

> 생성일: 2026-01-03
> 테스트 목적: PDF 처리 단순화 테스트 (열 분리/병합 제거)

## 요약
- **결과: ❌ 실패**
- 열 분리/병합을 제거하고 직접 OCR+AI 처리했으나 페이지 번호 오인식 문제 지속

## 테스트 환경
- 테스트 파일: Grammar Effect 정답지 PDF (17페이지)
- 수정 내용: _pickPdfForAll() 메서드에서 열 분리/병합 로직 제거
- 테스트 방법: "전체 PDF 업로드" 버튼 사용

## 테스트 과정
1. ✅ flutter analyze 완료 (deprecated 경고만 존재)
2. ✅ 폰 빌드 및 실행 성공
3. ✅ PDF 처리 완료 (17페이지 모두 처리)
4. ❌ 페이지 번호 오인식 발생

## 테스트 결과

### PDF 처리 결과
```
[PDF처리] 총 추출 결과: 51개 교재 페이지
[PDF처리] 정렬 후 페이지 번호: [0, 0, 2, 3, 4, 6, 7, 16, 16, 17, 18, 18, 19, 19, 20, 20, 20, 21, 22, 22, 24, 26, 28, 30, 32, 32, 34, 44, 44, 45, 45, 46, 58, 59, 60, 61, 62, 62, 63, 64, 64, 65, 66, 67, 74, 76, 86, 106, 107, 108, 142]
[PDF처리] ⚠️ 중복 페이지 발견! 원본: 51개, 고유: 39개
```

### 주요 문제점
1. **페이지 번호 오인식**
   - 0페이지, 142페이지 등 비정상적인 페이지 번호
   - 실제 정답지 페이지(p.9, p.11 등)와 불일치

2. **중복 페이지 다수 발생**
   - 총 51개 중 12개가 중복
   - 동일 페이지가 여러 번 인식됨

3. **2열 레이아웃 처리 실패**
   - CP의 예상대로 2열 PDF에서 페이지 경계 인식 실패
   - 한 PDF 페이지에 여러 교재 페이지가 섞여 있는 경우 제대로 분리 못함

## 원인 분석

### 가설 검증 결과
- **가설**: 열 분리/병합 과정이 품질 저하의 원인
- **결과**: 열 분리/병합을 제거해도 문제 지속
- **결론**: 문제의 원인은 열 처리가 아닌 다른 곳에 있음

### 실제 원인 추정
1. **PDF → 이미지 변환 품질 문제**
   - PDF 페이지를 이미지로 변환할 때 품질 손실 가능
   - 해상도나 압축 설정 확인 필요

2. **2열 레이아웃의 구조적 문제**
   - Claude AI가 2열 PDF에서 개별 페이지 경계를 제대로 인식 못함
   - 여러 교재 페이지가 한 PDF 페이지에 섞여 있을 때 분리 실패

3. **프롬프트 문제**
   - 현재 프롬프트가 단일 페이지 이미지 기준으로 작성됨
   - 2열 레이아웃 특화 프롬프트 필요

## 갤러리 테스트와의 비교
테스트 후반부에 갤러리에서 개별 이미지를 선택한 것으로 보이는 로그:
```
[Claude] p.9 섹션 A: 4개 정답
[Claude] p.11 섹션 A: 4개 정답
[Claude] p.13 섹션 A: 4개 정답
[Claude] p.15 섹션 A: 4개 정답
[Claude] 총 4개 페이지 파싱 완료
```
→ 개별 이미지는 정상 인식됨

## 다음 단계 제안

### 1. PDF → 이미지 변환 개선 (BIG_141)
- 해상도 설정 확인 (현재 150 DPI → 300 DPI?)
- 이미지 품질 비교 테스트

### 2. 프롬프트 개선 (BIG_142)
- 2열 레이아웃 전용 프롬프트 작성
- "한 이미지에 여러 페이지가 있을 수 있다"는 명시적 지시

### 3. 페이지별 분리 처리 (BIG_143)
- PDF의 각 페이지를 좌우로 분리 후 개별 처리
- 분리된 각 이미지를 갤러리 선택과 동일하게 처리

## 로그 파일
- 저장 위치: `ai_bridge/logs/big_140_test.log`
- 필터링 명령: `adb logcat -d | grep -E "[PDF처리]|[Claude]|[MlKitOcr]|ERROR|Exception" | tail -200`

## 결론
열 분리/병합 제거만으로는 문제가 해결되지 않았습니다. 2열 PDF의 구조적 문제를 해결하기 위해서는 다른 접근이 필요합니다.