# BIG_094: 프로그래매틱 재로그인 방식 테스트 보고서

> 생성일: 2025-12-25
> 테스트: BIG_094_RELOGIN_TEST.md
> 결과: **실패**

---

## 📋 테스트 개요

### 목표
- 초대 수락 후 프로그래매틱 재로그인을 통한 자동 화면 전환
- 사용자 입장에서 자연스러운 UX 제공

### 기대 결과
- 초대 수락 → 2초 대기 → 자동 재로그인 → 학원 홈 화면 이동

---

## ❌ 테스트 결과: 실패

### 실제 발생한 상황
1. 초대 수락 버튼 클릭 ✅
2. 로딩 화면 시작 ✅
3. 로딩이 돌다가 멈춘 후 ❌
4. **다시 초대 수락 화면으로 되돌아감** ❌

---

## 🔍 근본 원인 분석

### 로그 분석 결과
```
1525: [LOG] 재로그인 성공 → 홈 화면 전환  ← 로그상으로는 성공
1542: stopped(true) old = false              ← 앱이 정지됨
1543: WindowStopped on MainActivity set to true  ← 백그라운드로 이동
```

### 실패 메커니즘
1. **프로그래매틱 재로그인 과정 완료** (기술적으로는 성공)
2. **앱이 예기치 않게 백그라운드로 이동**
3. **실제 화면 전환이 중단됨**
4. **사용자가 앱을 다시 활성화하면 여전히 초대 화면**

---

## 🔄 BIG_093 vs BIG_094 비교 분석

| 항목 | BIG_093 (Cognito 세션 새로고침) | BIG_094 (프로그래매틱 재로그인) |
|------|--------------------------------|--------------------------------|
| **기술적 구현** | ✅ Cognito 세션만 갱신 | ✅ 완전한 재로그인 |
| **화면 전환** | ✅ 즉시 성공 | ❌ 앱 생명주기로 실패 |
| **앱 안정성** | ✅ 앱 상태 유지 | ❌ 백그라운드 이동 |
| **사용자 경험** | ✅ 자연스러운 전환 | ❌ 끊김 현상 |
| **로그 정확성** | ✅ 실제 결과와 일치 | ❌ 로그와 실제 상황 불일치 |

---

## 💡 핵심 문제점

### 1. **앱 생명주기 관리 이슈**
- 프로그래매틱 재로그인 과정에서 Flutter 앱이 예기치 않게 백그라운드 모드로 전환
- Android Activity의 생명주기가 인증 플로우에 의해 영향받음

### 2. **인증 플로우의 부작용**
- Cognito 재로그인 과정이 앱의 포커스를 잃게 만듦
- 화면 전환 로직이 앱 백그라운드 전환으로 중단됨

### 3. **로그와 실제 동작의 불일치**
- 로그상으로는 "홈 화면 전환" 성공으로 표시
- 실제로는 전환이 완료되지 않음

---

## 🔧 해결 방안 검토

### Option A: 앱 생명주기 제어 강화
- **복잡도**: 높음
- **위험도**: 높음 (다른 기능에 영향 가능)
- **효과**: 불확실

### Option B: 백그라운드 복귀 시 화면 전환 처리
- **복잡도**: 중간
- **위험도**: 중간
- **효과**: 제한적 (여전히 UX 끊김)

### Option C: BIG_093 방식 채택
- **복잡도**: 낮음 (이미 구현됨)
- **위험도**: 낮음 (검증 완료)
- **효과**: 확실함 ✅

---

## 🎯 권장 사항

### **BIG_093 방식 정식 채택**
1. **기술적 안정성**: Cognito 세션 새로고침은 앱 생명주기에 영향 없음
2. **우수한 UX**: 즉시 화면 전환, 끊김 없음
3. **검증 완료**: 실제 테스트에서 완벽 동작 확인

### **BIG_094 방식 보류**
- 앱 생명주기 문제 해결 전까지 사용 중단
- 추후 Flutter/Cognito 버전 업데이트 후 재검토 고려

---

## 📊 테스트 로그 요약

### 성공한 단계들
```
[LOG] 로그인 성공: owner_test1
[LOG] 로그아웃
[LOG] 로그인 성공: maknae12@gmail.com
[LOG] 수락 버튼 클릭
[LOG] Invitation 업데이트 완료
[LOG] Lambda 완료 대기 중...
[LOG] 프로그래매틱 재로그인 시작
```

### UserSyncService 세부 동작
```
[UserSyncService] syncCurrentUser: START
[UserSyncService] √ Cognito user: username=maknae12@gmail.com
[UserSyncService] √ Found 4 attributes
[UserSyncService] √ AppUser already exists: id=a498ad1c-6011-70c6-2f00-92a2fad64b02
[LOG] 로그인 성공: maknae12@gmail.com
[LOG] 재로그인 성공 → 홈 화면 전환  ← 여기서 실제로는 실패
```

### 앱 생명주기 문제 시점
```
WindowStopped on MainActivity set to true  ← 백그라운드 전환
```

---

## 🔚 결론

**BIG_094 프로그래매틱 재로그인 방식은 기술적으로는 구현되었으나, 실제 운영 환경에서는 앱 생명주기 문제로 인해 신뢰할 수 없는 동작을 보입니다.**

**따라서 BIG_093 Cognito 세션 새로고침 방식을 정식으로 채택할 것을 강력히 권장합니다.**

---

*보고서 작성: Claude Code AI*
*분석 완료일: 2025-12-25*